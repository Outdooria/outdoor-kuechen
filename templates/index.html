<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Outdoor-Küche Vorschau</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; margin: 0; }
    #container {
      position: relative; display: inline-block; border: 1px solid #ccc;
      margin-top: 20px; background-size: 20px 20px;
      max-width: 100%;
    }
    #container.grid {
      background-image:
        linear-gradient(to right, #ddd 1px, transparent 1px),
        linear-gradient(to bottom, #ddd 1px, transparent 1px);
    }
    #terrasse { max-width: 100%; display: block; }
    .kueche-wrapper {
      position: absolute; display: inline-block;
      transform-origin: center center; border: 2px dashed transparent;
    }
    .kueche-wrapper.active { border: 2px dashed #0077cc; }
    .kueche { width: 300px; display: block; cursor: move; touch-action: none; }
    .handle {
      position: absolute; width: 20px; height: 20px;
      background: #0077cc; border-radius: 50%; display: none;
    }
    .kueche-wrapper.active .handle { display: block; }
    .resizeHandle { right: -10px; bottom: -10px; cursor: se-resize; }
    .rotateHandle { left: 50%; top: -30px; margin-left: -10px; cursor: grab; }
    .gallery {
      display: flex; gap: 16px; justify-content: center;
      margin: 20px 0; flex-wrap: wrap;
    }
    .card { width: 200px; padding: 12px; border-radius: 10px; border: 1px solid #ddd; text-align: center; }
    .card img { width: 100%; height: auto; }
    .card button { margin-top: 6px; }
    #kitchenList {
      margin-top: 20px; text-align: left; max-width: 800px;
      margin-left: auto; margin-right: auto; border: 1px solid #ccc;
      border-radius: 6px; padding: 10px;
    }
    #kitchenList h3 { margin-top: 0; text-align: center; }
    .list-item {
      display: flex; justify-content: space-between;
      align-items: center; padding: 6px; border-bottom: 1px solid #eee;
    }
    .list-item.active { background: #eef6ff; }
    .list-item button {
      background: #dc3545; color: #fff; border: none; border-radius: 4px;
      cursor: pointer; padding: 4px 8px;
    }
    button {
      padding: 10px 14px; border: none; border-radius: 6px;
      background: #0077cc; color: #fff; cursor: pointer;
    }
    button.small { padding: 6px 10px; font-size: 14px; }
    #controls { margin: 15px 0; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
    #preview { margin-top: 20px; }
    #preview img {
      max-width: 100%;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    #preview button { margin: 5px; }

    /* �� Mobile Anpassungen */
    @media (max-width: 768px) {
      .gallery { flex-direction: column; align-items: center; }
      .card { width: 90%; margin-bottom: 16px; }
      button { width: 100%; margin-top: 6px; }
      #controls { flex-direction: column; }
      #kitchenList { font-size: 14px; }
    }
  </style>
</head>
<body>
  <h2>Outdoor-Küche Vorschau</h2>

  <form id="uploadForm" enctype="multipart/form-data">
    <p>Terrassenfoto hochladen:</p>
    <input type="file" name="terrasse" accept="image/*,.heic,.heif" required><br><br>
    <p>Eigene Küche hochladen (optional):</p>
    <input type="file" name="kueche" accept="image/*"><br><br>
    <button type="submit" class="small">Fotos verarbeiten (nur für eigene Küche)</button>
  </form>

  <!-- Galerie -->
  <div class="gallery" id="gallery"></div>

  <!-- Zusatz-Steuerung -->
  <div id="controls">
    <button type="button" id="toggleGridBtn">Raster anzeigen</button>
    <button type="button" id="undoBtn">⮪ Undo</button>
    <button type="button" id="redoBtn">Redo ⮫</button>
    <button type="button" id="resetBtn" style="background:#dc3545">Reset</button>
  </div>

  <!-- Container -->
  <div id="container">
    <img id="terrasse" alt="Terrasse">
  </div>

  <!-- Liste -->
  <div id="kitchenList">
    <h3>Platzierten Küchen</h3>
    <div id="listItems"></div>
  </div>

  <br>
  <button id="downloadBtn" style="display:none">Bild speichern</button>

  <!-- Vorschau -->
  <div id="preview"></div>

  <canvas id="resultCanvas" style="display:none;"></canvas>

  <script>
    const container = document.getElementById("container");
    const terrasse = document.getElementById("terrasse");
    const gallery = document.getElementById("gallery");
    const downloadBtn = document.getElementById("downloadBtn");
    const listItems = document.getElementById("listItems");
    const uploadForm = document.getElementById("uploadForm");
    const terrasseInput = document.querySelector('input[name="terrasse"]');
    const kuecheInput   = document.querySelector('input[name="kueche"]');
    const previewDiv = document.getElementById("preview");

    // ... (alle bisherigen Funktionen bleiben gleich)

    // ✅ Raster-Fix
    document.getElementById("toggleGridBtn").addEventListener("click", (e) => {
      container.classList.toggle("grid");
      if (container.classList.contains("grid")) {
        e.target.textContent = "Raster ausblenden";
      } else {
        e.target.textContent = "Raster anzeigen";
      }
    });

    // ... (Undo, Redo, Reset, Download + Vorschau wie gehabt)
  </script>
</body>
</html>
